(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8a95aeea"],{"3e21":function(e,t,s){},"7cb4":function(e,t,s){"use strict";s.r(t);var r=s("7a23");const a={class:"checkout-page"},c={class:"checkout-header"},i={class:"steps"},o={class:"checkout-content"},l={class:"checkout-form"},d={class:"form-grid"},n={class:"form-group"},b={key:0,class:"error-message"},m={class:"form-group"},u={key:0,class:"error-message"},O={class:"form-group"},j={key:0,class:"error-message"},p={class:"form-group"},f={key:0,class:"error-message"},y={class:"form-grid"},h={class:"form-group"},g={class:"postal-code-group"},v={key:0,class:"error-message"},C={class:"form-group"},N={key:0,class:"error-message"},k={class:"order-summary"},x={class:"order-items"},w={class:"item-info"},P=["src","alt"],_={class:"item-price"},q={class:"summary-totals"},S={class:"summary-row"},H={class:"summary-total"};function A(e,t,s,A,U,E){return Object(r["x"])(),Object(r["h"])("div",a,[Object(r["i"])("div",c,[t[10]||(t[10]=Object(r["i"])("h1",null,"Checkout",-1)),Object(r["i"])("div",i,[t[9]||(t[9]=Object(r["i"])("div",{class:"step active"},[Object(r["i"])("span",{class:"step-number"},"1"),Object(r["i"])("span",{class:"step-text"},"Shipping")],-1)),Object(r["i"])("div",{class:Object(r["r"])(["step",{active:e.isPaymentStep}])},t[8]||(t[8]=[Object(r["i"])("span",{class:"step-number"},"2",-1),Object(r["i"])("span",{class:"step-text"},"Payment",-1)]),2)])]),Object(r["i"])("div",o,[Object(r["i"])("div",l,[Object(r["i"])("form",{onSubmit:t[7]||(t[7]=Object(r["R"])((...t)=>e.handleSubmit&&e.handleSubmit(...t),["prevent"]))},[t[17]||(t[17]=Object(r["i"])("h2",null,"Shipping Information",-1)),Object(r["i"])("div",d,[Object(r["i"])("div",n,[t[11]||(t[11]=Object(r["i"])("label",null,"First Name",-1)),Object(r["P"])(Object(r["i"])("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.form.firstName=t),type:"text",required:"",class:Object(r["r"])({error:e.errors.firstName})},null,2),[[r["M"],e.form.firstName]]),e.errors.firstName?(Object(r["x"])(),Object(r["h"])("span",b,Object(r["H"])(e.errors.firstName),1)):Object(r["g"])("",!0)]),Object(r["i"])("div",m,[t[12]||(t[12]=Object(r["i"])("label",null,"Last Name",-1)),Object(r["P"])(Object(r["i"])("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.lastName=t),type:"text",required:"",class:Object(r["r"])({error:e.errors.lastName})},null,2),[[r["M"],e.form.lastName]]),e.errors.lastName?(Object(r["x"])(),Object(r["h"])("span",u,Object(r["H"])(e.errors.lastName),1)):Object(r["g"])("",!0)])]),Object(r["i"])("div",O,[t[13]||(t[13]=Object(r["i"])("label",null,"Email",-1)),Object(r["P"])(Object(r["i"])("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.email=t),type:"email",required:"",class:Object(r["r"])({error:e.errors.email})},null,2),[[r["M"],e.form.email]]),e.errors.email?(Object(r["x"])(),Object(r["h"])("span",j,Object(r["H"])(e.errors.email),1)):Object(r["g"])("",!0)]),Object(r["i"])("div",p,[t[14]||(t[14]=Object(r["i"])("label",null,"Street Address",-1)),Object(r["P"])(Object(r["i"])("input",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.address=t),type:"text",required:"",class:Object(r["r"])({error:e.errors.address})},null,2),[[r["M"],e.form.address]]),e.errors.address?(Object(r["x"])(),Object(r["h"])("span",f,Object(r["H"])(e.errors.address),1)):Object(r["g"])("",!0)]),Object(r["i"])("div",y,[Object(r["i"])("div",h,[t[15]||(t[15]=Object(r["i"])("label",null,"Postal Code",-1)),Object(r["i"])("div",g,[Object(r["P"])(Object(r["i"])("input",{"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.postalCode=t),type:"text",required:"",onBlur:t[5]||(t[5]=(...t)=>e.lookupAddress&&e.lookupAddress(...t)),class:Object(r["r"])({error:e.errors.postalCode})},null,34),[[r["M"],e.form.postalCode]]),e.errors.postalCode?(Object(r["x"])(),Object(r["h"])("span",v,Object(r["H"])(e.errors.postalCode),1)):Object(r["g"])("",!0)])]),Object(r["i"])("div",C,[t[16]||(t[16]=Object(r["i"])("label",null,"City",-1)),Object(r["P"])(Object(r["i"])("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.city=t),type:"text",required:"",class:Object(r["r"])({error:e.errors.city})},null,2),[[r["M"],e.form.city]]),e.errors.city?(Object(r["x"])(),Object(r["h"])("span",N,Object(r["H"])(e.errors.city),1)):Object(r["g"])("",!0)])]),t[18]||(t[18]=Object(r["i"])("button",{type:"submit",class:"submit-button"}," Continue to Payment ",-1))],32)]),Object(r["i"])("div",k,[t[22]||(t[22]=Object(r["i"])("h2",null,"Order Summary",-1)),Object(r["i"])("div",x,[(Object(r["x"])(!0),Object(r["h"])(r["a"],null,Object(r["B"])(e.cart.state.items,e=>(Object(r["x"])(),Object(r["h"])("div",{key:e.id,class:"order-item"},[Object(r["i"])("div",w,[Object(r["i"])("img",{src:e.image_url,alt:e.name},null,8,P),Object(r["i"])("div",null,[Object(r["i"])("h4",null,Object(r["H"])(e.name),1),Object(r["i"])("p",null,"Qty: "+Object(r["H"])(e.quantity),1)])]),Object(r["i"])("div",_," $"+Object(r["H"])((e.price*e.quantity).toFixed(2)),1)]))),128))]),Object(r["i"])("div",q,[Object(r["i"])("div",S,[t[19]||(t[19]=Object(r["i"])("span",null,"Subtotal",-1)),Object(r["i"])("span",null,"$"+Object(r["H"])(e.cart.state.total.toFixed(2)),1)]),t[21]||(t[21]=Object(r["i"])("div",{class:"summary-row"},[Object(r["i"])("span",null,"Shipping"),Object(r["i"])("span",null,"Free")],-1)),Object(r["i"])("div",H,[t[20]||(t[20]=Object(r["i"])("span",null,"Total",-1)),Object(r["i"])("span",null,"$"+Object(r["H"])(e.cart.state.total.toFixed(2)),1)])])])])])}var U=s("6605"),E=s("8c2f"),F=s("79a7"),M=Object(r["m"])({name:"Checkout",setup(){const e=Object(U["d"])(),t=Object(r["A"])(!1),s=Object(r["z"])({firstName:"",lastName:"",email:"",address:"",postalCode:"",city:""}),a=Object(r["z"])({}),c=e=>{const t=/^[1-9][0-9]{3}\s?[A-Za-z]{2}$/;return t.test(e)},i=()=>{c(s.postalCode)?s.postalCode=s.postalCode.replace(/\s/g,"").replace(/([0-9]{4})([A-Za-z]{2})/,"$1 $2").toUpperCase():a.postalCode="Please enter a valid postal code (e.g., 1234 AB)"},o=async()=>{try{const{data:{user:e}}=await F["a"].auth.getUser();if(!e)return;const{data:t,error:r}=await F["a"].from("profiles").select("*").eq("id",e.id).single();if(r)return void("PGRST116"!==r.code&&console.error("Error fetching profile:",r));t&&(s.firstName=t.first_name||"",s.lastName=t.last_name||"",s.email=e.email||"",s.address=t.address||"",s.postalCode=t.postal_code||"",s.city=t.city||"")}catch(e){console.error("Error fetching user address:",e)}},l=()=>(Object.keys(a).forEach(e=>delete a[e]),s.firstName||(a.firstName="First name is required"),s.lastName||(a.lastName="Last name is required"),s.email||(a.email="Email is required"),s.address||(a.address="Address is required"),s.postalCode?c(s.postalCode)||(a.postalCode="Please enter a valid postal code"):a.postalCode="Postal code is required",s.city||(a.city="City is required"),0===Object.keys(a).length),d=async()=>{if(l())try{const{data:{user:t}}=await F["a"].auth.getUser();if(!t)throw new Error("No user found");const{error:r}=await F["a"].from("profiles").upsert({id:t.id,first_name:s.firstName,last_name:s.lastName,address:s.address,postal_code:s.postalCode,city:s.city});if(r)throw r;const{data:a,error:c}=await F["a"].from("orders").insert({user_id:t.id,status:"pending",items:E["a"].state.items,total_amount:E["a"].state.total,payment_method:"pending",shipping_address:{first_name:s.firstName,last_name:s.lastName,email:s.email,address:s.address,postal_code:s.postalCode,city:s.city}}).select().single();if(c)throw c;E["a"].clear(),e.push({name:"OrderConfirmation",params:{orderId:a.id}})}catch(t){console.error("Error processing order:",t),alert("There was an error processing your order. Please try again.")}};return Object(r["v"])(()=>{o()}),{cart:E["a"],form:s,errors:a,isPaymentStep:t,handleSubmit:d,lookupAddress:i}}}),V=(s("e5ab"),s("6b0d")),$=s.n(V);const z=$()(M,[["render",A],["__scopeId","data-v-886c821c"]]);t["default"]=z},e5ab:function(e,t,s){"use strict";s("3e21")}}]);
//# sourceMappingURL=chunk-8a95aeea.7093d32d.js.map